/** @jsxImportSource @emotion/react */

import getProfilesByName from "../libs/searchApi";
import randomData from "../libs/randomData.json";
import Head from "next/head";
import Navbar from "../components/Navbar/Navbar";
import ProfileSection from "../components/ProfileSection/ProfileSection";
import PersonSection from "../components/PersonSection/PersonSection";
import PhotosSection from "../components/PhotosSection/PhotosSection";
import SearchSection from "../components/SearchSection/SearchSection";

import { createTheme, ThemeProvider } from "@mui/material/styles";
import { Box } from "@mui/system";
import { Grid } from "@mui/material";
import { useEffect, useState } from "react";

let theme = createTheme({
  palette: {
    mode: "light",
    primary: {
      main: "#fff",
      light: "#fff",
      dark: "#f5f5f5",
    },
  },
});

let getRandomTenData = () => {
  let holdData = [];
  for (let i = 0; i < 15; i++) {
    holdData.push(randomData[i]);
  }
  return holdData;
};

let filterOutUsersWithoutName = (users) => {
  let filtered = users.filter((item) => (item.name ? true : false));
  return filtered;
};

export default function Home() {
  let [isLoading, setLoading] = useState(true);
  let [isSearching, setSearching] = useState(true);
  let [selectedProfile, selectProfile] = useState(randomData[1]);
  let [searchTerm, setSearchTerm] = useState("random");
  let [people, foundPeople] = useState(getRandomTenData());

  useEffect(async () => {
    let users = await getProfilesByName(searchTerm);
    users = filterOutUsersWithoutName(users.response.results);
    foundPeople(users);
    setLoading(false);
  }, [searchTerm]);

  const selectPerson = (item) => {
    selectProfile(item);
    setLoading(false);
    setSearching(false);
  };

  const changeToSearchSection = () => {
    setSearching(true);
  };

  const changeTheSearchTerm = (event) => {
    setSearchTerm(event.target.value);
  };

  return (
    <ThemeProvider theme={theme}>
      <div>
        <Head>
          <title>Create Next App</title>
          <meta name="description" content="Generated by create next app" />
        </Head>
        <header>
          <Navbar setSearchTerm={changeTheSearchTerm} searchTerm={searchTerm} />
        </header>
        {/*Main body start  */}
        <main>
          <Box className="main-page">
            <Grid container spacing={0} className="top-page-grid">
              <Grid
                item
                xs={12}
                md={6}
                sm={6}
                lg={3}
                className="profile-section"
              >
                <ProfileSection />
              </Grid>

              {!isSearching && !isLoading && (
                <Grid
                  item
                  xs={12}
                  md={6}
                  sm={6}
                  lg={3}
                  className="person-section"
                >
                  <PersonSection
                    changeToSearchSection={changeToSearchSection}
                    profile={selectedProfile}
                  />
                </Grid>
              )}
              {isSearching && !isLoading && (
                <Grid
                  item
                  xs={12}
                  md={6}
                  sm={6}
                  lg={3}
                  className="person-section"
                >
                  <SearchSection
                    setLoading={setLoading}
                    selectPerson={selectPerson}
                    data={people}
                  />
                </Grid>
              )}

              <Grid item xs={12} md={12} sm={12} lg={6}>
                <PhotosSection />
              </Grid>
            </Grid>
          </Box>
        </main>

        {/* Main body end--------------- */}
      </div>
    </ThemeProvider>
  );
}
